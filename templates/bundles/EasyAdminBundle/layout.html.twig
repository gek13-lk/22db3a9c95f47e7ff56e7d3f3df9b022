{# @var ea \EasyCorp\Bundle\EasyAdminBundle\Context\AdminContext #}
{% extends '@!EasyAdmin/layout.html.twig' %}

{% block head_metas %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noodp, noimageindex, notranslate, nocache"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Референс-центр. Графики">
    <meta name="author" content="Поставил цель - добегайся">

    <link rel="icon" href="{{ asset('./img/favicon.svg') }}" type="image/x-icon">
{% endblock head_metas %}

{% block page_title %}Референс-центр - {{ block('content_title') }}{% endblock %}

{% block head_stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/bootstrap.min.css') }}"/>
    <link rel="stylesheet" href="{{ asset('fonts/style.css') }}"/>
    <link rel="stylesheet" href="{{ asset('css/main.min.css') }}"/>
    <link rel="stylesheet" href="{{ asset('dist/fontawesome-pro-6.5.2-web/css/all.min.css') }}"/>
    <style>
        .badge + .badge {
            margin-left: 2px;
        }
    </style>
{% endblock %}

{% block body %}
    <body {% block body_attr %}{% endblock %}
            id="{% block body_id %}{% endblock %}"
            class="ea {% block body_class %}{% endblock %}"
    >
    <div id="loading-wrapper">
        <div class="spinner-border" role="status">
            <span class="sr-only">Загрузка...</span>
        </div>
    </div>

    {% block wrapper_wrapper %}
        {% block flash_messages %}
            {{ include(ea.templatePath('flash_messages')) }}
        {% endblock flash_messages %}


    <header class="header">
        <div class="container-fluid">
            <div class="row gutters">
                <div class="col-sm-4 col-4">
                    <a href="" class="logo">Референс-центр. <span>Планирование</span></a>
                </div>
                <div class="col-sm-8 col-8">
                    <ul class="header-actions">
                        <li class="dropdown d-none d-sm-block">
                            <a href="#" class="contact">
                                <i class="icon-phone"></i> +7 (495) 276-04-36
                            </a>
                        </li>
                        <li class="dropdown d-none d-sm-block">
                            <a href="#" id="notifications" data-toggle="dropdown" aria-haspopup="true">
                                <i class="icon-bell"></i>
                                <span class="count-label"></span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right" style="min-width: 320px" aria-labelledby="notifications">
                                <div class="dropdown-menu-header">
                                    <h5>Уведомления</h5>
                                    <p class="m-0 sub-title">5 непрочитанных</p>
                                </div>
                                <ul class="header-notifications">
                                    <li>
                                        <a href="#" class="clearfix">
                                            <div class="avatar">
                                                <img src="/img/hospital/appointment.svg" alt="Medical Admin Dashboards"/>
                                                <span class="notify-iocn icon-layers text-danger"></span>
                                            </div>
                                            <div class="details">
                                                <h6>Сгенерирован график на 08-2024</h6>
                                                <p>Посмотреть</p>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="clearfix">
                                            <div class="avatar">
                                                <img src="/img/hospital/appointment.svg" alt="Medical Admin Dashboards"/>
                                                <span class="notify-iocn icon-layers text-info"></span>
                                            </div>
                                            <div class="details">
                                                <h6>Сгенерирован график на 07-2024</h6>
                                                <p>Посмотреть</p>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="clearfix">
                                            <div class="avatar">
                                                <img src="/img/hospital/appointment.svg" alt="Medical Admin Dashboards"/>
                                                <span class="notify-iocn icon-person_add text-success"></span>
                                            </div>
                                            <div class="details">
                                                <h6>Сотрудник запросил Отпуск</h6>
                                                <p>Посмотреть</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="dropdown">
                            {% set user_menu_avatar %}
                                {% if null == ea.userMenu.avatarUrl %}
                                    <img class="user-avatar" src="{{ asset('img/user/user' ~ (app.user.id % 20) ~ '.png') }}" />
                                {% else %}
                                    <img class="user-avatar" src="{{ ea.userMenu.avatarUrl }}" />
                                {% endif %}
                            {% endset %}
                            {% set user_menu_username %}
                                {{ ea.user is null ? 'user.anonymous'|trans(domain = 'EasyAdminBundle') : ea.userMenu.name }}
                            {% endset %}
                            {% set user_menu_role %}
                                {{ ea.user is null ? '' : getRoles()|join(' | ') }}
                            {% endset %}

                            <a href="#" id="userSettings" class="user-settings" data-toggle="dropdown" aria-haspopup="true">
                                <span class="user-name">{{ user_menu_username }}</span>
                                <span class="avatar">{{ user_menu_avatar }}</span>
                            </a>

                            {% block user_menu %}
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userSettings">
                                    <div class="header-profile-actions">
                                        <div class="header-user-profile">
                                            <div class="header-user">
                                                {% if null == ea.userMenu.avatarUrl %}
                                                    <img class="user-avatar" src="{{ asset('img/user/user' ~ (app.user.id % 20) ~ '.png') }}" />
                                                {% else %}
                                                    <img class="user-avatar" src="{{ ea.userMenu.avatarUrl }}" />
                                                {% endif %}
                                            </div>
                                            <h5>{{ user_menu_username }}</h5>
                                            <p>{{ user_menu_role }}</p>
                                        </div>
                                        {% if ea.userMenu.items|length > 0 %}
                                            {% for item in ea.userMenu.items %}
                                                <a href="{{ item.linkUrl }}" class="{{ item.cssClass }}"
                                                   target="{{ item.linkTarget }}" rel="{{ item.linkRel }}"
                                                   referrerpolicy="origin-when-cross-origin">
                                                    {% if item.icon is not empty %}<i class="{{ item.icon }}"></i>{% endif %}
                                                    {{ item.label|trans }}
                                                </a>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            {% endblock user_menu %}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        {% block sidebar %}
                    {% block main_menu_wrapper %}
                        {{ include(ea.templatePath('main_menu')) }}
                    {% endblock main_menu_wrapper %}
        {% endblock sidebar %}

        {% block content %}
            <div class="main-container">
                <div class="page-header">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item active">
                            {% block breadcrumb %}
                                {% set break = false %}
                                {% for menuItem in ea.mainMenu.items %}
                                    {% if not break and menuItem.isSelected %}
                                        {{ menuItem.label|trans|raw }}
                                        {% set break = true %}
                                    {% endif %}

                                    {% if not break %}
                                        {% for subItem in menuItem.subItems %}
                                            {% if not break and subItem.isSelected %}
                                                {{ menuItem.label|trans|raw }} / {{ subItem.label|trans|raw }}
                                                {% set break = true %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
                            {% endblock %}
                        </li>
                    </ol>
                    <div class="site-award">
                        <img src="/img/award.png">
                    </div>
                </div>
                <div class="content content-wrapper" style="max-width: 100% !important;">
                    <div class="row gutters mb-2 d-flex justify-content-end">{% block page_actions %}{% endblock %}</div>
                    <div class="row gutters position-relative" style="min-height: calc(100vh - 260px);">
                        {% block main %}{% endblock %}
                    </div>
                </div>
            </div>
        {% endblock %}
    </div>

        <footer class="main-footer">© Поставил цель - добегайся 2024</footer>
        <div class="modal fade" style="z-index:1000001;" id="trainingModelModal" tabindex="-1" role="dialog" aria-labelledby="trainingModelModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="trainingModelModalLabel">Подтвердите действие</h5>
                    </div>
                    <div class="modal-body">
                        Вы точно хотите переобучить модели прогнозирования? <br>
                        <p class="timing">Переобучать модели следует, если были добавлены новые данные. Так модели будут прогнозировать более точно.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancelButton" data-dismiss="modal">Отмена</button>
                        <button type="button" class="btn btn-primary" id="confirmTrainingButton">Обновить прогнозы</button>
                    </div>
                </div>
            </div>
        </div>
    {% endblock wrapper_wrapper %}

    {% block body_javascript %}
        <script src="{{ asset('js/jquery.min.js') }}"></script>
        <script src="{{ asset('js/bootstrap.bundle.min.js') }}"></script>
        <script src="{{ asset('js/moment.js') }}"></script>
        <script src="{{ asset('js/main.js') }}"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const formWidgets = document.querySelectorAll('.form-widget');

                formWidgets.forEach(widget => {
                    const labels = widget.querySelectorAll('label');
                    const inputs = widget.querySelectorAll('input');

                    labels.forEach(label => {
                        label.classList.add('form-control');
                    });

                    inputs.forEach(input => {
                        input.classList.add('form-control');
                    });
                });

                const clearButtons = document.querySelectorAll('.clear-button');
                clearButtons.forEach(clearButton => {
                    clearButton.textContent = 'Очистить всё';
                    clearButton.style.color = '#b3b3b3';
                });

                const trainingButton = document.querySelector('.training-model');
                const confirmButton = document.getElementById('confirmTrainingButton');
                const cancelButton = document.getElementById('cancelButton');

                if (trainingButton) {
                    trainingButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        $('#trainingModelModal').modal('show');
                    });
                }

                if (confirmButton) {
                    confirmButton.addEventListener('click', function() {
                        $.ajax({
                            type: 'POST',
                            url: '{{ path('training_model') }}',
                            success: function(response) {
                                $('#trainingModelModal').modal('hide');
                            },
                            error: function(error) {
                                console.error('Произошла ошибка при выполнении POST запроса', error);
                            }
                        });
                    });
                }

                if (cancelButton) {
                    cancelButton.addEventListener('click', closeModal);
                }

                function closeModal() {
                    $('#trainingModelModal').modal('hide');
                }
            });
        </script>
    {% endblock body_javascript %}

    {% block configured_body_contents %}
        {% for htmlContent in ea.assets.bodyContents ?? [] %}
            {{ htmlContent|raw }}
        {% endfor %}
    {% endblock %}
    </body>
{% endblock body %}
